# Title: Formbook Process Creation
# Author: Florian Roth (Nextron Systems), oscd.community, Jonhnathan Ribeiro
# Date: 2019-09-30
# Level: high
# Description: Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters.
# MITRE Tactic: Resource Development
# Tags: attack.resource-development, attack.t1587.001, detection.emerging-threats

ParentCommandLine="*.exe" ParentCommandLine IN ("C:\\Windows\\System32\\*", "C:\\Windows\\SysWOW64\\*") (CommandLine="*/c*" CommandLine="*del*" CommandLine="*C:\\Users\\*" CommandLine="*\\AppData\\Local\\Temp\\*") OR (CommandLine="*/c*" CommandLine="*del*" CommandLine="*C:\\Users\\*" CommandLine="*\\Desktop\\*") OR (CommandLine="*/C*" CommandLine="*type nul >*" CommandLine="*C:\\Users\\*" CommandLine="*\\Desktop\\*") CommandLine="*.exe" | table CommandLine,ParentCommandLine