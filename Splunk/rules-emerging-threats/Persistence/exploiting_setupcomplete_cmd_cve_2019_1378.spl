# Title: Exploiting SetupComplete.cmd CVE-2019-1378
# Author: Florian Roth (Nextron Systems), oscd.community, Jonhnathan Ribeiro
# Date: 2019-11-15
# Level: high
# Description: Detects exploitation attempt of privilege escalation vulnerability via SetupComplete.cmd and PartnerSetupComplete.cmd described in CVE-2019-1378
# MITRE Tactic: Persistence
# Tags: attack.persistence, attack.defense-evasion, attack.privilege-escalation, attack.t1068, attack.execution, attack.t1059.003, attack.t1574, cve.2019-1378, detection.emerging-threats

ParentCommandLine="*\\cmd.exe*" ParentCommandLine="*/c*" ParentCommandLine="*C:\\Windows\\Setup\\Scripts\\*" ParentCommandLine IN ("*SetupComplete.cmd", "*PartnerSetupComplete.cmd") NOT (Image IN ("C:\\Windows\\System32\\*", "C:\\Windows\\SysWOW64\\*", "C:\\Windows\\WinSxS\\*", "C:\\Windows\\Setup\\*"))