# Title: UNC4841 - SSL Certificate Exfiltration Via Openssl
# Author: Nasreddine Bencherchali (Nextron Systems)
# Date: 2023-06-16
# Level: high
# Description: Detects the execution of "openssl" to connect to an IP address. This techniques was used by UNC4841 to exfiltrate SSL certificates and as a C2 channel with named pipes. Investigate commands executed in the temporal vicinity of this command.
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.t1140, detection.emerging-threats

CommandLine IN ("*:443*", "*:8080*") CommandLine="*s_client*" CommandLine="*-quiet*" CommandLine="*-connect*" Image="*/openssl"
| regex CommandLine="[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}"