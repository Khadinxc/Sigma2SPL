# Title: Potential Exploitation of GoAnywhere MFT Vulnerability
# Author: MSFT (idea), Swachchhanda Shrawan Poudel (Nextron Systems)
# Date: 2025-10-07
# Level: high
# Description: Detects suspicious command execution by child processes of the GoAnywhere Managed File Transfer (MFT) application, which may indicate exploitation such as CVE-2025-10035.
# This behavior is indicative of post-exploitation activity related to CVE-2025-10035, as observed in campaigns by the threat actor Storm-1175.
# MITRE Tactic: Initial Access
# Tags: attack.initial-access, attack.t1190, attack.execution, attack.t1059.001, attack.persistence, attack.t1133, detection.emerging-threats, cve.2025-10035
# False Positives:
#   - Legitimate administrative scripts or built-in GoAnywhere functions could potentially trigger this rule. Tuning may be required based on normal activity in your environment.


| rex field=CommandLine "(?<CommandLineMatch>net\\s+user)"
| eval CommandLineCondition=if(isnotnull(CommandLineMatch), "true", "false")
| rex field=CommandLine "(?<CommandLineMatch2>net\\s+group)"
| eval CommandLineCondition2=if(isnotnull(CommandLineMatch2), "true", "false")
| rex field=CommandLine "(?<CommandLineMatch3>query\\s+session)"
| eval CommandLineCondition3=if(isnotnull(CommandLineMatch3), "true", "false")
| search ParentImage="*\\GoAnywhere\\tomcat\\*" ((CommandLine="*IEX*" CommandLine="*enc*" CommandLine="*Hidden*" CommandLine="*bypass*") OR CommandLineCondition="true" OR CommandLineCondition2="true" OR CommandLineCondition3="true" OR CommandLine IN ("*whoami*", "*systeminfo*", "*dsquery*", "*localgroup administrators*", "*nltest*", "*samaccountname=*", "*adscredentials*", "*o365accountconfiguration*", "*.DownloadString(*", "*.DownloadFile(*", "*FromBase64String(*", "*System.IO.Compression*", "*System.IO.MemoryStream*", "*curl*") Image IN ("*\\powershell.exe", "*\\powershell_ise.exe", "*\\pwsh.exe")) OR (CommandLine IN ("*powershell*", "*whoami*", "*net.exe*", "*net1.exe*", "*rundll32*", "*quser*", "*nltest*", "*curl*") Image="*\\cmd.exe") OR CommandLine IN ("*bitsadmin*", "*certutil*", "*mshta*", "*cscript*", "*wscript*")