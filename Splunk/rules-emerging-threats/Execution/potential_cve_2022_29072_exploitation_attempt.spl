# Title: Potential CVE-2022-29072 Exploitation Attempt
# Author: frack113, @kostastsale
# Date: 2022-04-17
# Level: high
# Description: Detects potential exploitation attempts of CVE-2022-29072, a 7-Zip privilege escalation and command execution vulnerability.
# 7-Zip version 21.07 and earlier on Windows allows privilege escalation (CVE-2022-29072) and command execution when a file with the .7z extension is dragged to the Help>Contents area. This is caused by misconfiguration of 7z.dll and a heap overflow.
# The command runs in a child process under the 7zFM.exe process.
# MITRE Tactic: Execution
# Tags: attack.execution, cve.2022-29072, detection.emerging-threats

Image IN ("*\\cmd.exe", "*\\powershell.exe", "*\\pwsh.exe") OR OriginalFileName IN ("Cmd.Exe", "PowerShell.EXE", "pwsh.dll") ParentImage="*\\7zFM.exe" NOT (CommandLine IN ("* /c *", "* /k *", "* /r *") OR CommandLine IN ("*.bat", "*.cmd", "*.ps1") OR NOT CommandLine=*)