# Title: Potential Devil Bait Malware Reconnaissance
# Author: Nasreddine Bencherchali (Nextron Systems), NCSC (Idea)
# Date: 2023-05-15
# Level: high
# Description: Detects specific process behavior observed with Devil Bait samples
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.t1218, detection.emerging-threats
# False Positives:
#   - Unlikely


| rex field=CommandLine "(?<CommandLineMatch>ipconfig\\s+/all)"
| eval CommandLineCondition=if(isnotnull(CommandLineMatch), "true", "false")
| search CommandLineCondition="true" OR CommandLine IN ("*dir*", "*systeminfo*", "*tasklist*") CommandLine="*>>%APPDATA%\\Microsoft\\*" CommandLine IN ("*.xml", "*.txt") Image="*\\cmd.exe" ParentImage="*\\wscript.exe"