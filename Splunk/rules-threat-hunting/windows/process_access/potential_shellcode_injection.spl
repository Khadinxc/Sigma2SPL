# Title: Potential Shellcode Injection
# Author: Bhabesh Raj
# Date: 2022-03-11
# Level: medium
# Description: Detects potential shellcode injection as seen used by tools such as Metasploit's migrate and Empire's psinject.
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.privilege-escalation, attack.t1055, detection.threat-hunting

CallTrace="*UNKNOWN*" GrantedAccess IN ("0x147a", "0x1f3fff") NOT (SourceImage="C:\\Windows\\System32\\Wbem\\Wmiprvse.exe" TargetImage="C:\\Windows\\system32\\lsass.exe") NOT ((SourceImage IN ("C:\\Program Files\\Dell\\*", "C:\\Program Files (x86)\\Dell\\*") TargetImage IN ("C:\\Program Files\\Dell\\*", "C:\\Program Files (x86)\\Dell\\*")) OR (SourceImage="C:\\Program Files (x86)\\Dell\\UpdateService\\ServiceShell.exe" TargetImage="C:\\Windows\\Explorer.EXE") OR (SourceImage="C:\\Program Files\\Microsoft Visual Studio\\*" TargetImage="C:\\Program Files\\Microsoft Visual Studio\\*"))