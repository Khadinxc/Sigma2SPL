# Title: Suspicious WebDav Client Execution Via Rundll32.EXE
# Author: Nasreddine Bencherchali (Nextron Systems), Florian Roth (Nextron Systems)
# Date: 2023-03-16
# Level: high
# Description: Detects "svchost.exe" spawning "rundll32.exe" with command arguments like C:\windows\system32\davclnt.dll,DavSetCookie. This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server) or potentially a sign of exploitation of CVE-2023-23397
# MITRE Tactic: Exfiltration
# Tags: attack.exfiltration, attack.t1048.003, cve.2023-23397

CommandLine="*C:\\windows\\system32\\davclnt.dll,DavSetCookie*" Image="*\\rundll32.exe" ParentCommandLine="*-s WebClient*" ParentImage="*\\svchost.exe" NOT (CommandLine IN ("*://10.*", "*://192.168.*", "*://172.16.*", "*://172.17.*", "*://172.18.*", "*://172.19.*", "*://172.20.*", "*://172.21.*", "*://172.22.*", "*://172.23.*", "*://172.24.*", "*://172.25.*", "*://172.26.*", "*://172.27.*", "*://172.28.*", "*://172.29.*", "*://172.30.*", "*://172.31.*", "*://127.*", "*://169.254.*"))
| regex CommandLine="://\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}"