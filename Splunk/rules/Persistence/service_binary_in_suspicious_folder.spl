# Title: Service Binary in Suspicious Folder
# Author: Florian Roth (Nextron Systems), frack113
# Date: 2022-05-02
# Level: high
# Description: Detect the creation of a service with a service binary located in a suspicious directory
# MITRE Tactic: Persistence
# Tags: attack.persistence, attack.defense-evasion, attack.t1112

(Details IN ("*\\Users\\Public\\*", "*\\Perflogs\\*", "*\\ADMIN$\\*", "*\\Temp\\*") TargetObject="*\\ImagePath" TargetObject="HKLM\\System\\CurrentControlSet\\Services\\*") OR (Details IN ("DWORD (0x00000000)", "DWORD (0x00000001)", "DWORD (0x00000002)") Image IN ("*\\Users\\Public\\*", "*\\Perflogs\\*", "*\\ADMIN$\\*", "*\\Temp\\*") TargetObject="*\\Start" TargetObject="HKLM\\System\\CurrentControlSet\\Services\\*") NOT ((Image="*\\Common Files\\*" Image="*\\Temp\\*") OR (Details="*\\AppData\\Local\\Temp\\MBAMInstallerService.exe\"" Image="C:\\Windows\\system32\\services.exe" TargetObject="*\\CurrentControlSet\\Services\\MBAMInstallerService\\ImagePath"))