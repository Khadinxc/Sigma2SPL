# Title: Wlrmdr.EXE Uncommon Argument Or Child Process
# Author: frack113, manasmbellani
# Date: 2022-02-16
# Level: medium
# Description: Detects the execution of "Wlrmdr.exe" with the "-u" command line flag which allows anything passed to it to be an argument of the ShellExecute API, which would allow an attacker to execute arbitrary binaries.
# This detection also focuses on any uncommon child processes spawned from "Wlrmdr.exe" as a supplement for those that posses "ParentImage" telemetry.
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.t1218

ParentImage="*\\wlrmdr.exe" OR (CommandLine="*-a *" OR CommandLine="*/a *" OR CommandLine="*–a *" OR CommandLine="*—a *" OR CommandLine="*―a *" CommandLine="*-f *" OR CommandLine="*/f *" OR CommandLine="*–f *" OR CommandLine="*—f *" OR CommandLine="*―f *" CommandLine="*-m *" OR CommandLine="*/m *" OR CommandLine="*–m *" OR CommandLine="*—m *" OR CommandLine="*―m *" CommandLine="*-s *" OR CommandLine="*/s *" OR CommandLine="*–s *" OR CommandLine="*—s *" OR CommandLine="*―s *" CommandLine="*-t *" OR CommandLine="*/t *" OR CommandLine="*–t *" OR CommandLine="*—t *" OR CommandLine="*―t *" CommandLine="*-u *" OR CommandLine="*/u *" OR CommandLine="*–u *" OR CommandLine="*—u *" OR CommandLine="*―u *" Image="*\\wlrmdr.exe" OR OriginalFileName="WLRMNDR.EXE" NOT (ParentImage IN ("", "-") OR NOT ParentImage=* OR ParentImage="C:\\Windows\\System32\\winlogon.exe"))