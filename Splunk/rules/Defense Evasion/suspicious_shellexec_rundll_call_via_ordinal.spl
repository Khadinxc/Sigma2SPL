# Title: Suspicious ShellExec_RunDLL Call Via Ordinal
# Author: Swachchhanda Shrawan Poudel
# Date: 2024-12-01
# Level: high
# Description: Detects suspicious call to the "ShellExec_RunDLL" exported function of SHELL32.DLL through the ordinal number to launch other commands.
# Adversary might only use the ordinal number in order to bypass existing detection that alert on usage of ShellExec_RunDLL on CommandLine.
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.t1218.011

ParentCommandLine="*SHELL32.DLL*" ParentCommandLine IN ("*#568*", "*#570*", "*#572*", "*#576*") Image IN ("*\\bash.exe", "*\\bitsadmin.exe", "*\\cmd.exe", "*\\cscript.exe", "*\\curl.exe", "*\\mshta.exe", "*\\msiexec.exe", "*\\msxsl.exe", "*\\odbcconf.exe", "*\\powershell.exe", "*\\pwsh.exe", "*\\regsvr32.exe", "*\\schtasks.exe", "*\\wmic.exe", "*\\wscript.exe") OR ParentCommandLine IN ("*comspec*", "*iex*", "*Invoke-*", "*msiexec*", "*odbcconf*", "*regsvr32*") OR ParentCommandLine IN ("*\\Desktop\\*", "*\\ProgramData\\*", "*\\Temp\\*", "*\\Users\\Public\\*")