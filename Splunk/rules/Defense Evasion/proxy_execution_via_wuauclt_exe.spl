# Title: Proxy Execution Via Wuauclt.EXE
# Author: Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research), Florian Roth (Nextron Systems), Sreeman, FPT.EagleEye Team
# Date: 2020-10-12
# Level: high
# Description: Detects the use of the Windows Update Client binary (wuauclt.exe) for proxy execution.
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.t1218, attack.execution

CommandLine="*UpdateDeploymentProvider*" CommandLine="*RunHandlerComServer*" Image="*\\wuauclt.exe" OR OriginalFileName="wuauclt.exe" NOT (CommandLine="* /UpdateDeploymentProvider UpdateDeploymentProvider.dll *" OR CommandLine IN ("*:\\Windows\\UUS\\Packages\\Preview\\amd64\\updatedeploy.dll /ClassId*", "*:\\Windows\\UUS\\amd64\\UpdateDeploy.dll /ClassId*") OR (CommandLine="*:\\Windows\\WinSxS\\*" CommandLine="*\\UpdateDeploy.dll /ClassId *") OR CommandLine="* wuaueng.dll *")