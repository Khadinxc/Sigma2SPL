# Title: Potential Persistence Via Outlook Today Page
# Author: Tobias Michalski (Nextron Systems), David Bertho (@dbertho) & Eirik Sveen (@0xSV1), Storebrand
# Date: 2021-06-10
# Level: high
# Description: Detects potential persistence activity via outlook today page.
# An attacker can set a custom page to execute arbitrary code and link to it via the registry values "URL" and "UserDefinedUrl".
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.persistence, attack.t1112

TargetObject="*Software\\Microsoft\\Office\\*" TargetObject="*\\Outlook\\Today\\*" (Details="DWORD (0x00000001)" TargetObject="*\\Stamp") OR TargetObject IN ("*\\URL", "*\\UserDefinedUrl") NOT (Image="*\\OfficeClickToRun.exe" Image IN ("C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\*", "C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\*"))