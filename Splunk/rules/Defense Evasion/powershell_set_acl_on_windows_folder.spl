# Title: PowerShell Set-Acl On Windows Folder
# Author: Nasreddine Bencherchali (Nextron Systems)
# Date: 2022-10-18
# Level: high
# Description: Detects PowerShell scripts to set the ACL to a file in the Windows folder
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion

CommandLine="*Set-Acl *" CommandLine="*-AclObject *" OriginalFileName IN ("PowerShell.EXE", "pwsh.dll") OR Image IN ("*\\powershell.exe", "*\\pwsh.exe") CommandLine IN ("*-Path \"C:\\Windows*", "*-Path 'C:\\Windows*", "*-Path %windir%*", "*-Path $env:windir*") CommandLine IN ("*FullControl*", "*Allow*")