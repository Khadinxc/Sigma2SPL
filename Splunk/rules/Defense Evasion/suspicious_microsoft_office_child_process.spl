# Title: Suspicious Microsoft Office Child Process
# Author: Florian Roth (Nextron Systems), Markus Neis, FPT.EagleEye Team, Vadim Khrykov, Cyb3rEng, Michael Haag, Christopher Peacock @securepeacock, @scythe_io
# Date: 2018-04-06
# Level: high
# Description: Detects a suspicious process spawning from one of the Microsoft Office suite products (Word, Excel, PowerPoint, Publisher, Visio, etc.)
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.execution, attack.t1047, attack.t1204.002, attack.t1218.010

ParentImage IN ("*\\EQNEDT32.EXE", "*\\EXCEL.EXE", "*\\MSACCESS.EXE", "*\\MSPUB.exe", "*\\ONENOTE.EXE", "*\\POWERPNT.exe", "*\\VISIO.exe", "*\\WINWORD.EXE", "*\\wordpad.exe", "*\\wordview.exe") OriginalFileName IN ("bitsadmin.exe", "CertOC.exe", "CertUtil.exe", "Cmd.Exe", "CMSTP.EXE", "cscript.exe", "curl.exe", "HH.exe", "IEExec.exe", "InstallUtil.exe", "javaw.exe", "Microsoft.Workflow.Compiler.exe", "msdt.exe", "MSHTA.EXE", "msiexec.exe", "Msxsl.exe", "odbcconf.exe", "pcalua.exe", "PowerShell.EXE", "RegAsm.exe", "RegSvcs.exe", "REGSVR32.exe", "RUNDLL32.exe", "schtasks.exe", "ScriptRunner.exe", "wmic.exe", "WorkFolders.exe", "wscript.exe") OR Image IN ("*\\AppVLP.exe", "*\\bash.exe", "*\\bitsadmin.exe", "*\\certoc.exe", "*\\certutil.exe", "*\\cmd.exe", "*\\cmstp.exe", "*\\control.exe", "*\\cscript.exe", "*\\curl.exe", "*\\forfiles.exe", "*\\hh.exe", "*\\ieexec.exe", "*\\installutil.exe", "*\\javaw.exe", "*\\mftrace.exe", "*\\Microsoft.Workflow.Compiler.exe", "*\\msbuild.exe", "*\\msdt.exe", "*\\mshta.exe", "*\\msidb.exe", "*\\msiexec.exe", "*\\msxsl.exe", "*\\odbcconf.exe", "*\\pcalua.exe", "*\\powershell.exe", "*\\pwsh.exe", "*\\regasm.exe", "*\\regsvcs.exe", "*\\regsvr32.exe", "*\\rundll32.exe", "*\\schtasks.exe", "*\\scrcons.exe", "*\\scriptrunner.exe", "*\\sh.exe", "*\\svchost.exe", "*\\verclsid.exe", "*\\wmic.exe", "*\\workfolders.exe", "*\\wscript.exe") OR Image IN ("*\\AppData\\*", "*\\Users\\Public\\*", "*\\ProgramData\\*", "*\\Windows\\Tasks\\*", "*\\Windows\\Temp\\*", "*\\Windows\\System32\\Tasks\\*")