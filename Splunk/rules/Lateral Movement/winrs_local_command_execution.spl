# Title: Winrs Local Command Execution
# Author: Liran Ravich, Nasreddine Bencherchali
# Date: 2025-10-22
# Level: high
# Description: Detects the execution of Winrs.exe where it is used to execute commands locally.
# Commands executed this way are launched under Winrshost.exe and can represent proxy execution used for defense evasion or lateral movement.
# MITRE Tactic: Lateral Movement
# Tags: attack.lateral-movement, attack.defense-evasion, attack.t1021.006, attack.t1218
# False Positives:
#   - Unlikely

(Image="*\\winrs.exe" OR OriginalFileName="winrs.exe" CommandLine="*-r:localhost*" OR CommandLine="*/r:localhost*" OR CommandLine="*–r:localhost*" OR CommandLine="*—r:localhost*" OR CommandLine="*―r:localhost*" OR CommandLine="*-r:127.0.0.1*" OR CommandLine="*/r:127.0.0.1*" OR CommandLine="*–r:127.0.0.1*" OR CommandLine="*—r:127.0.0.1*" OR CommandLine="*―r:127.0.0.1*" OR CommandLine="*-r:[::1]*" OR CommandLine="*/r:[::1]*" OR CommandLine="*–r:[::1]*" OR CommandLine="*—r:[::1]*" OR CommandLine="*―r:[::1]*" OR CommandLine="*-remote:localhost*" OR CommandLine="*/remote:localhost*" OR CommandLine="*–remote:localhost*" OR CommandLine="*—remote:localhost*" OR CommandLine="*―remote:localhost*" OR CommandLine="*-remote:127.0.0.1*" OR CommandLine="*/remote:127.0.0.1*" OR CommandLine="*–remote:127.0.0.1*" OR CommandLine="*—remote:127.0.0.1*" OR CommandLine="*―remote:127.0.0.1*" OR CommandLine="*-remote:[::1]*" OR CommandLine="*/remote:[::1]*" OR CommandLine="*–remote:[::1]*" OR CommandLine="*—remote:[::1]*" OR CommandLine="*―remote:[::1]*") OR (Image="*\\winrs.exe" OR OriginalFileName="winrs.exe" NOT (CommandLine="*-r:*" OR CommandLine="*/r:*" OR CommandLine="*–r:*" OR CommandLine="*—r:*" OR CommandLine="*―r:*" OR CommandLine="*-remote:*" OR CommandLine="*/remote:*" OR CommandLine="*–remote:*" OR CommandLine="*—remote:*" OR CommandLine="*―remote:*"))