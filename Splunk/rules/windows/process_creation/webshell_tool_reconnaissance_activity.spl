# Title: Webshell Tool Reconnaissance Activity
# Author: Cian Heasley, Florian Roth (Nextron Systems)
# Date: 2020-07-22
# Level: high
# Description: Detects processes spawned from web servers (PHP, Tomcat, IIS, etc.) that perform reconnaissance looking for the existence of popular scripting tools (perl, python, wget) on the system via the help commands
# MITRE Tactic: Persistence
# Tags: attack.persistence, attack.t1505.003

(ParentImage IN ("*-tomcat-*", "*\\tomcat*") ParentImage IN ("*\\java.exe", "*\\javaw.exe")) OR (CommandLine IN ("*CATALINA_HOME*", "*catalina.jar*") ParentImage IN ("*\\java.exe", "*\\javaw.exe")) OR ParentImage IN ("*\\caddy.exe", "*\\httpd.exe", "*\\nginx.exe", "*\\php-cgi.exe", "*\\w3wp.exe", "*\\ws_tomcatservice.exe") CommandLine IN ("*perl --help*", "*perl -h*", "*python --help*", "*python -h*", "*python3 --help*", "*python3 -h*", "*wget --help*")