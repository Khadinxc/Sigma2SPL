# Title: Suspicious PowerShell Invocations - Specific - ProcessCreation
# Author: Nasreddine Bencherchali (Nextron Systems)
# Date: 2023-01-05
# Level: medium
# Description: Detects suspicious PowerShell invocation command parameters
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion

(CommandLine="*-nop*" CommandLine="* -w *" CommandLine="*hidden*" CommandLine="* -c *" CommandLine="*[Convert]::FromBase64String*") OR (CommandLine="* -w *" CommandLine="*hidden*" CommandLine="*-ep*" CommandLine="*bypass*" CommandLine="*-Enc*") OR (CommandLine="* -w *" CommandLine="*hidden*" CommandLine="*-noni*" CommandLine="*-nop*" CommandLine="* -c *" CommandLine="*iex*" CommandLine="*New-Object*") OR (CommandLine="*iex*" CommandLine="*New-Object*" CommandLine="*Net.WebClient*" CommandLine="*.Download*") OR (CommandLine="*powershell*" CommandLine="*reg*" CommandLine="*add*" CommandLine="*\\software\\*") OR (CommandLine="*bypass*" CommandLine="*-noprofile*" CommandLine="*-windowstyle*" CommandLine="*hidden*" CommandLine="*new-object*" CommandLine="*system.net.webclient*" CommandLine="*.download*") NOT (CommandLine IN ("*(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1*", "*Write-ChocolateyWarning*"))