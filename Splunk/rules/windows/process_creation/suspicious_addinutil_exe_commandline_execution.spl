# Title: Suspicious AddinUtil.EXE CommandLine Execution
# Author: Nasreddine Bencherchali (Nextron Systems), Michael McKinley (@McKinleyMike), Tony Latteri (@TheLatteri)
# Date: 2023-09-18
# Level: high
# Description: Detects execution of the Add-In deployment cache updating utility (AddInutil.exe) with suspicious Addinroot or Pipelineroot paths. An adversary may execute AddinUtil.exe with uncommon Addinroot/Pipelineroot paths that point to the adversaries Addins.Store payload.
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.t1218

Image="*\\addinutil.exe" OR OriginalFileName="AddInUtil.exe" (CommandLine IN ("*-AddInRoot:*", "*-PipelineRoot:*") CommandLine IN ("*\\AppData\\Local\\Temp\\*", "*\\Desktop\\*", "*\\Downloads\\*", "*\\Users\\Public\\*", "*\\Windows\\Temp\\*")) OR (CommandLine IN ("*-AddInRoot:.*", "*-AddInRoot:\".\"*", "*-PipelineRoot:.*", "*-PipelineRoot:\".\"*") CurrentDirectory IN ("*\\AppData\\Local\\Temp\\*", "*\\Desktop\\*", "*\\Downloads\\*", "*\\Users\\Public\\*", "*\\Windows\\Temp\\*"))