# Title: Rundll32 Execution With Uncommon DLL Extension
# Author: Tim Shelton, Florian Roth (Nextron Systems), Yassine Oukessou
# Date: 2022-01-13
# Level: medium
# Description: Detects the execution of rundll32 with a command line that doesn't contain a common extension
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.t1218.011

Image="*\\rundll32.exe" OR OriginalFileName="RUNDLL32.EXE" NOT (CommandLine="" OR CommandLine IN ("*.cpl *", "*.cpl,*", "*.cpl\"*", "*.cpl'*", "*.dll *", "*.dll,*", "*.dll\"*", "*.dll'*", "*.inf *", "*.inf,*", "*.inf\"*", "*.inf'*") OR CommandLine IN ("*.cpl", "*.dll", "*.inf") OR CommandLine="* -localserver *" OR NOT CommandLine=* OR (CommandLine="*:\\Windows\\Installer\\*" CommandLine="*.tmp*" CommandLine="*zzzzInvokeManagedCustomActionOutOfProc*" ParentImage="*\\msiexec.exe")) NOT (ParentCommandLine="*:\\Users\\*" ParentCommandLine="*\\AppData\\Local\\Microsoft\\EdgeUpdate\\Install\\{*" ParentCommandLine="*\\EDGEMITMP_*" ParentCommandLine="*.tmp\\setup.exe*" ParentCommandLine="*--install-archive=*" ParentCommandLine="*--previous-version=*" ParentCommandLine="*--msedgewebview --verbose-logging --do-not-launch-msedge --user-level*")