# Title: File Download Using ProtocolHandler.exe
# Author: frack113
# Date: 2021-07-13
# Level: medium
# Description: Detects usage of "ProtocolHandler" to download files. Downloaded files will be located in the cache folder (for example - %LOCALAPPDATA%\Microsoft\Windows\INetCache\IE)
# MITRE Tactic: Defense Evasion
# Tags: attack.defense-evasion, attack.t1218

CommandLine IN ("*ftp://*", "*http://*", "*https://*") Image="*\\protocolhandler.exe" OR OriginalFileName="ProtocolHandler.exe"