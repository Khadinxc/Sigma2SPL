# Title: Potential Persistence Via Event Viewer Events.asp
# Author: Nasreddine Bencherchali (Nextron Systems)
# Date: 2023-02-17
# Level: medium
# Description: Detects potential registry persistence technique using the Event Viewer "Events.asp" technique
# MITRE Tactic: Persistence
# Tags: attack.persistence, attack.defense-evasion, attack.t1112

TargetObject IN ("*\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\\MicrosoftRedirectionProgram*", "*\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\\MicrosoftRedirectionURL*") NOT (Details="(Empty)" OR (Details="%%SystemRoot%%\\PCHealth\\HelpCtr\\Binaries\\HelpCtr.exe" Image="*C:\\WINDOWS\\system32\\svchost.exe" TargetObject="*\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\\MicrosoftRedirectionProgram") OR (Details="-url hcp://services/centers/support*topic=%%s" Image="*C:\\WINDOWS\\system32\\svchost.exe" TargetObject="*\\Microsoft\\Windows NT\\CurrentVersion\\Event Viewer\\MicrosoftRedirectionProgramCommandLineParameters") OR Details="http://go.microsoft.com/fwlink/events.asp")