# Title: Add Port Monitor Persistence in Registry
# Author: frack113
# Date: 2021-12-30
# Level: medium
# Description: Adversaries may use port monitors to run an attacker supplied DLL during system boot for persistence or privilege escalation.
# A port monitor can be set through the AddMonitor API call to set a DLL to be loaded at startup.
# MITRE Tactic: Privilege Escalation
# Tags: attack.privilege-escalation, attack.persistence, attack.t1547.010

Details="*.dll" TargetObject="*\\Control\\Print\\Monitors\\*" NOT ((Details="cpwmon64_v40.dll" Image="C:\\Windows\\System32\\spoolsv.exe" TargetObject="*\\Control\\Print\\Monitors\\CutePDF Writer Monitor v4.0\\Driver*" User IN ("*AUTHORI*", "*AUTORI*")) OR TargetObject="*\\Control\\Print\\Monitors\\MONVNC\\Driver*" OR (TargetObject="*Control\\Print\\Environments\\*" TargetObject="*\\Drivers\\*" TargetObject="*\\VNC Printer*"))