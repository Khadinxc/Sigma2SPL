# Title: External Remote SMB Logon from Public IP
# Author: Micah Babinski (@micahbabinski), Zach Mathis (@yamatosecurity)
# Date: 2023-01-19
# Level: high
# Description: Detects successful logon from public IP address via SMB. This can indicate a publicly-exposed SMB port.
# MITRE Tactic: Privilege Escalation
# Tags: attack.privilege-escalation, attack.persistence, attack.defense-evasion, attack.initial-access, attack.credential-access, attack.t1133, attack.t1078, attack.t1110
# False Positives:
#   - Legitimate or intentional inbound connections from public IP addresses on the SMB port.

EventID=4624 LogonType=3 NOT (IpAddress="-" OR IpAddress="::1/128" OR IpAddress="10.0.0.0/8" OR IpAddress="127.0.0.0/8" OR IpAddress="172.16.0.0/12" OR IpAddress="192.168.0.0/16" OR IpAddress="169.254.0.0/16" OR IpAddress="fc00::/7" OR IpAddress="fe80::/10")