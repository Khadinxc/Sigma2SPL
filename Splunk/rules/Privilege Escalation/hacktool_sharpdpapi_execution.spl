# Title: HackTool - SharpDPAPI Execution
# Author: Nasreddine Bencherchali (Nextron Systems)
# Date: 2024-06-26
# Level: high
# Description: Detects the execution of the SharpDPAPI tool based on CommandLine flags and PE metadata.
# SharpDPAPI is a C# port of some DPAPI functionality from the Mimikatz project.
# MITRE Tactic: Privilege Escalation
# Tags: attack.privilege-escalation, attack.defense-evasion, attack.t1134.001, attack.t1134.003

Image="*\\SharpDPAPI.exe" OR OriginalFileName="SharpDPAPI.exe" OR (CommandLine IN ("* backupkey *", "* blob *", "* certificates *", "* credentials *", "* keepass *", "* masterkeys *", "* rdg *", "* vaults *") CommandLine IN ("* /file:*", "* /machine*", "* /mkfile:*", "* /password:*", "* /pvk:*", "* /server:*", "* /target:*", "* /unprotect*") OR (CommandLine="* {*" CommandLine="*}:*"))