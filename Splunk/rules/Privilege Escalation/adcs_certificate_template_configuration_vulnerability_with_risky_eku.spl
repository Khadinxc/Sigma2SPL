# Title: ADCS Certificate Template Configuration Vulnerability with Risky EKU
# Author: Orlinum , BlueDefenZer
# Date: 2021-11-17
# Level: high
# Description: Detects certificate creation with template allowing risk permission subject and risky EKU
# MITRE Tactic: Privilege Escalation
# Tags: attack.privilege-escalation, attack.credential-access
# False Positives:
#   - Administrator activity
#   - Proxy SSL certificate with subject modification
#   - Smart card enrollement

(EventID=4898 TemplateContent IN ("*1.3.6.1.5.5.7.3.2*", "*1.3.6.1.5.2.3.4*", "*1.3.6.1.4.1.311.20.2.2*", "*2.5.29.37.0*") TemplateContent="*CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT*") OR (EventID=4899 NewTemplateContent IN ("*1.3.6.1.5.5.7.3.2*", "*1.3.6.1.5.2.3.4*", "*1.3.6.1.4.1.311.20.2.2*", "*2.5.29.37.0*") NewTemplateContent="*CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT*")