# Title: LSASS Access From Non System Account
# Author: Roberto Rodriguez @Cyb3rWard0g
# Date: 2019-06-20
# Level: medium
# Description: Detects potential mimikatz-like tools accessing LSASS from non system account
# MITRE Tactic: Credential Access
# Tags: attack.credential-access, attack.t1003.001

AccessMask IN ("0x100000", "0x1010", "0x1400", "0x1410", "0x1418", "0x1438", "0x143a", "0x1f0fff", "0x1f1fff", "0x1f2fff", "0x1f3fff", "0x40", "143a", "1f0fff", "1f1fff", "1f2fff", "1f3fff") EventID IN (4663, 4656) ObjectName="*\\lsass.exe" ObjectType="Process" NOT (ProcessName IN ("*:\\Program Files\\*", "*:\\Program Files (x86)\\*") OR SubjectUserName="*$" OR (AccessMask="0x1410" ProcessName="C:\\Windows\\System32\\wbem\\WmiPrvSE.exe")) NOT ProcessName="*\\SteamLibrary\\steamapps\\*"