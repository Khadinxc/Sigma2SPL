# Title: Potential Credential Dumping Activity Via LSASS
# Author: Samir Bousseaden, Michael Haag
# Date: 2019-04-03
# Level: medium
# Description: Detects process access requests to the LSASS process with specific call trace calls and access masks.
# This behaviour is expressed by many credential dumping tools such as Mimikatz, NanoDump, Invoke-Mimikatz, Procdump and even the Taskmgr dumping feature.
# MITRE Tactic: Credential Access
# Tags: attack.credential-access, attack.t1003.001, attack.s0002

CallTrace IN ("*dbgcore.dll*", "*dbghelp.dll*", "*kernel32.dll*", "*kernelbase.dll*", "*ntdll.dll*") GrantedAccess IN ("*0x1038*", "*0x1438*", "*0x143a*", "*0x1fffff*") TargetImage="*\\lsass.exe" NOT (SourceUser IN ("*AUTHORI*", "*AUTORI*")) NOT (SourceImage="*:\\Windows\\Sysmon64.exe" OR (CallTrace="*:\\Windows\\Temp\\asgard2-agent\\*" CallTrace="*\\thor\\thor64.exe+*" CallTrace="*|UNKNOWN(*" GrantedAccess="0x103800"))