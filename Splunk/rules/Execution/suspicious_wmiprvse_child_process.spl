# Title: Suspicious WmiPrvSE Child Process
# Author: Vadim Khrykov (ThreatIntel), Cyb3rEng, Florian Roth (Nextron Systems)
# Date: 2021-08-23
# Level: high
# Description: Detects suspicious and uncommon child processes of WmiPrvSE
# MITRE Tactic: Execution
# Tags: attack.execution, attack.defense-evasion, attack.t1047, attack.t1204.002, attack.t1218.010

ParentImage="*\\wbem\\WmiPrvSE.exe" Image IN ("*\\certutil.exe", "*\\cscript.exe", "*\\mshta.exe", "*\\msiexec.exe", "*\\regsvr32.exe", "*\\rundll32.exe", "*\\verclsid.exe", "*\\wscript.exe") OR (CommandLine IN ("*cscript*", "*mshta*", "*powershell*", "*pwsh*", "*regsvr32*", "*rundll32*", "*wscript*") Image="*\\cmd.exe") NOT ((CommandLine="*/i *" Image="*\\msiexec.exe") OR Image="*\\WerFault.exe" OR Image="*\\WmiPrvSE.exe")