# Title: HackTool - CrackMapExec PowerShell Obfuscation
# Author: Thomas Patzke
# Date: 2020-05-22
# Level: high
# Description: The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule.
# MITRE Tactic: Execution
# Tags: attack.execution, attack.t1059.001, attack.defense-evasion, attack.t1027.005

CommandLine IN ("*join*split*", "*( $ShellId[1]+$ShellId[13]+'x')*", "*( $PSHome[*]+$PSHOME[*]+*", "*( $env:Public[13]+$env:Public[5]+'x')*", "*( $env:ComSpec[4,*,25]-Join'')*", "*[1,3]+'x'-Join'')*") Image IN ("*\\powershell.exe", "*\\pwsh.exe") OR OriginalFileName IN ("PowerShell.EXE", "pwsh.dll") | table ComputerName,User,CommandLine