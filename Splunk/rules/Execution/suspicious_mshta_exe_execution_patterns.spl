# Title: Suspicious Mshta.EXE Execution Patterns
# Author: Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
# Date: 2021-07-17
# Level: high
# Description: Detects suspicious mshta process execution patterns
# MITRE Tactic: Execution
# Tags: attack.execution, attack.t1106

(Image="*\\mshta.exe" OR OriginalFileName="MSHTA.EXE" CommandLine IN ("*\\AppData\\Local\\*", "*C:\\ProgramData\\*", "*C:\\Users\\Public\\*", "*C:\\Windows\\Temp\\*") ParentImage IN ("*\\cmd.exe", "*\\cscript.exe", "*\\powershell.exe", "*\\pwsh.exe", "*\\regsvr32.exe", "*\\rundll32.exe", "*\\wscript.exe")) OR (Image="*\\mshta.exe" OR OriginalFileName="MSHTA.EXE" NOT (Image IN ("C:\\Windows\\System32\\*", "C:\\Windows\\SysWOW64\\*") OR CommandLine IN ("*.htm*", "*.hta*") OR CommandLine IN ("*mshta.exe", "*mshta")))