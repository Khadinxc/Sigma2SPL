# Title: File Download From IP URL Via Curl.EXE
# Author: Nasreddine Bencherchali (Nextron Systems)
# Date: 2023-10-18
# Level: medium
# Description: Detects file downloads directly from IP address URL using curl.exe
# MITRE Tactic: Execution
# Tags: attack.execution

CommandLine IN ("* -O*", "*--remote-name*", "*--output*") CommandLine="*http*" Image="*\\curl.exe" OR OriginalFileName="curl.exe" NOT (CommandLine IN ("*.bat", "*.bat\"", "*.dat", "*.dat\"", "*.dll", "*.dll\"", "*.exe", "*.exe\"", "*.gif", "*.gif\"", "*.hta", "*.hta\"", "*.jpeg", "*.jpeg\"", "*.log", "*.log\"", "*.msi", "*.msi\"", "*.png", "*.png\"", "*.ps1", "*.ps1\"", "*.psm1", "*.psm1\"", "*.vbe", "*.vbe\"", "*.vbs", "*.vbs\"", "*.bat'", "*.dat'", "*.dll'", "*.exe'", "*.gif'", "*.hta'", "*.jpeg'", "*.log'", "*.msi'", "*.png'", "*.ps1'", "*.psm1'", "*.vbe'", "*.vbs'"))
| regex CommandLine="://[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}"