# Title: Potentially Suspicious Command Executed Via Run Dialog Box - Registry
# Author: Ahmed Farouk, Nasreddine Bencherchali
# Date: 2024-11-01
# Level: high
# Description: Detects execution of commands via the run dialog box on Windows by checking values of the "RunMRU" registry key.
# This technique was seen being abused by threat actors to deceive users into pasting and executing malicious commands, often disguised as CAPTCHA verification steps.
# MITRE Tactic: Execution
# Tags: attack.execution, attack.t1059.001

TargetObject="*\\Microsoft\\Windows\\CurrentVersion\\Explorer\\RunMRU*" (Details IN ("*powershell*", "*pwsh*") Details IN ("* -e *", "* -ec *", "* -en *", "* -enc *", "* -enco*", "*ftp*", "*Hidden*", "*http*", "*iex*", "*Invoke-*")) OR (Details="*wmic*" Details IN ("*shadowcopy*", "*process call create*"))